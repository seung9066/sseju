<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/layout}">

<head>
<meta charset="utf-8">
<script src="https://cdn.jsdelivr.net/npm/vue@2.7.13/dist/vue.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

<style>
th {
	cursor: pointer;
	border: 0.1px solid gray;
}

.menuTable {
	width: 90%;
	margin-left: 5%;
	height: 100px;
	text-align: center;
	border: 0.1px solid gray;
	background-color: white;
}

th {
	width: 50%;
}
</style>
</head>
<body>
	<article layout:fragment="content">
		<main id="main" class="main">

			<h4 style="margin-bottom: 3%;">
				<strong>BOM 관리</strong>
			</h4>
			<div>
			</div>
			<div style="float: right; margin-bottom: 3%;">
				<button class="button" style="width: 100px; height: 30px;"
					onclick="selectDelete()">삭제</button>
			</div>
				<h3 id="title">전체</h3>
			<div id="grid" style="width: 30%; float:left; margin-right:3%;">
				<div id="menuGrid"></div>
			</div>

			<div id="grid" style="width: 60%; float:right;">
				<div id="bomGrid"></div>
			</div>
			<script>
			
			menuAll();
			showAll();
			
			const menuGrid = new tui.Grid({
				el : document.getElementById('menuGrid'),
				pagination:true,
				pageOption: {
					useClient:true,
					perPage:10
				},
				scrollX : false,
				scrollY : false,
				columns : [ {
					header : '제품명',
					name : 'prtName',
				}]
			});
			
			const BOMGrid = new tui.Grid({
				el : document.getElementById('bomGrid'),
				pagination:true,
				pageOption: {
					useClient:true,
					perPage:10
				},
				scrollX : false,
				scrollY : false,
				columns : [ {
					header : '재료명',
					name : 'matName',
				}, {
					header : '용량',
					name : 'capacity', //납기일자명 수정
				}]
			});
			
			var deleteCode = [];
			
			menuGrid.on('click', (ev) => {
				let prtName = ev.nativeEvent.target.innerText;
				console.log(prtName);
				
				$.ajax({
					url:'bomList',
					data:{prtName:prtName},
					dataType:"json",
					async:false,
					success:function(data){
						BOMGrid.resetData(data);
					},
					error:function(request,status,error){
						alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
						console.log(reject);
					}
				})
				
			});
			
			function selectDelete() {
				console.log(BOMGrid.getCheckedRows());
				let code = [];
				for(co of BOMGrid.getCheckedRows()){
					console.log(co)
					code.push(co.code)
					console.log(code);
				}
				
				$.ajax({
					url:'selectDeleteCP',
					type:'GET',
					data:{code:code},
					dataType:"json",
					async:false,
					success:function(data){
						if(data > 0) {
							alert("삭제완료");
							showAll();					
						} else {
							alert("삭제실패");
						}
					},
					error:function(request,status,error){
						alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
						console.log(code);
						console.log(reject);
					}
				})
			}
			
			function menuAll() {
				url="bomMenu"
				       fetch(url) // 설비 단건조회 불러오는 아작스
				       .then(res=>res.json())
				       .then(obj=>{
				           console.log(obj);
				           menuGrid.resetData(obj);
				       })
			}
			
			function showAll() {
				$('#title').text("전체");
				
				url="codeList"
				       fetch(url) // 설비 단건조회 불러오는 아작스
				       .then(res=>res.json())
				       .then(obj=>{
				           console.log(obj);
				           BOMGrid.resetData(obj);
				       })
			}
			
			function showBOM() {
				$("#title").text("거래처");
				
				
			}

			</script>
		</main>
	</article>

	<!-- Vendor JS Files -->
	<script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
	<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="assets/vendor/chart.js/chart.min.js"></script>
	<script src="assets/vendor/echarts/echarts.min.js"></script>
	<script src="assets/vendor/quill/quill.min.js"></script>
	<script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
	<script src="assets/vendor/tinymce/tinymce.min.js"></script>
	<script src="assets/vendor/php-email-form/validate.js"></script>

	<!-- Template Main JS File -->
	<script src="assets/js/main.js"></script>

</body>

</html>