<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sseju.java.order.mapper.ORMapper">

	<!-- 제품 목록 조회 -->

	<!-- 주문내역 조회 -->
	<select id="selectOrderList" resultType="ORVO">
		SELECT
		a.order_no,
		TO_CHAR(a.order_date, 'YYYY-MM-DD') AS order_date,
		c.prt_name,
		TO_CHAR(a.d_day, 'YYYY-MM-DD') AS d_day,
		b.order_qty,
		a.order_prg
		FROM
		orders a,
		order_Inf b,
		product c
		where
		a.order_no = b.order_no
		and
		b.prt_code = c.prt_code

	</select>

	<!-- 진행중인 주문서 현황에 진행중인 주문 -->
	<select id="selectOrdeIng" resultType="ORVO">
	<![CDATA[
		SELECT 
				 TO_CHAR(a.order_date, 'YYYY-MM-DD') AS order_date,
				 a.order_no,
				 d.cp_name,
				 c.prt_name,
				 c.prt_unit,
				 b.order_out_qty
		FROM 
				    orders a,
				    order_Inf b,
				    product c,
				    company d
		where 		a.order_no = b.order_no
		and 		b.prt_code = c.prt_code
		and 		a.cp_code = d.cp_code
		and         a.order_prg <> '배송완료'
	]]>
	</select>


	<select id="selectPrtManager" resultType="ORVO">
	select
		c.prt_name,
			sum(b.order_qty) as order_qty,
			sum(b.order_out_qty) as order_out_qty,
	        sum(lot_qty) as lot_qty
		from orders a,order_inf b,product c,lot f
		where a.order_no =b.order_no
			and c.prt_code = b.prt_code
	        and c.prt_code = f.mp_code
		GROUP BY c.PRT_NAME


	</select>

	<!-- 주문 테이블 등록 쿼리 추가하기 -->
	<!-- <insert id="insertOrderInfo" parameterType="ORVO"> INSERT INTO orders 
		( ORDER_NO, D_DAY, ORDER_PRG, ORDER_DATE, CP_CODE, ORDER_YN, ) VALUES ( #{orderNo}, 
		#{dDay}, #{orderPrg}, #{orderDate}, #{cpCode}, #{ordetYn} ) </insert> 주문상세 
		테이블 등록 쿼리 추가하기 <insert id="insertOrderInfo" parameterType="ORVO"> INSERT 
		INTO order_inf (pre_no, order_qty, order_out_qty, order_no, prt_code, unit_price, 
		order_price ) VALUES (#{preNo}, #{orderQty}, #{orderOutQty}, #{orderNo}, 
		#{prtCode}, #{unitPrice}, #{orderPrice}) </insert> -->
	<!-- 단거조회 -->
	<select id="selectOrderInfo" parameterType="ORVO">
		select ORDER_NO,
			TO_CHAR(a.d_day, 'YYYY-MM-DD') AS d_day,
			ORDER_PRG,
			ORDER_DATE,
			CP_CODE,
		ORDER_YN
		from orders
		where
			order_no=#{orderNo}
	</select>

	<!-- 수정 -->
	<update id="updateOrderInfo" parameterType="ORVO">
		UPDATE orders
		<set>
			d_day =#{dDay},
			order_date = #{orderDate}
		</set>
		where order_no = #{orderNo}
	</update>

	<!-- 삭제 -->
	<!-- <delete id="deleteOrderInfo" parameterType="Integer"> delete from orders 
		where order_no = #{orderNo} </delete> -->



</mapper>