<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sseju.java.eqm.mapper.EqmMapper">
   <!-- 설비 eqm -->
   <!-- 전체조회 -->
   <select id="selectEqmList" resultType="EqmVO">
      SELECT * FROM EQM ORDER BY
      EQM_CODE ASC
   </select>


   <insert id="insertEqm" parameterType="EqmVO">
    
      INSERT INTO EQM
      VALUES(
      #{eqmCode},
      #{eqmName},
      #{eqmModel},
      #{eqmSize},
      #{eqmLoc},
      #{eqmMaxTemp},
      #{eqmMinTemp},
      #{eqmCheck},
      #{eqmPurcDate},
      #{eqmDiv},
      #{eqmImg},
      #{eqmPurcName},
      #{eqmPurcTel},
      #{eqmYn},
      #{lineNo},
      #{eqmNo}
      )
   </insert>

   <!-- 설비 수정 -->
   <update id="updateEqmInfo" parameterType="EqmVO">
      UPDATE EQM q
      <set>
         eqm_name = #{eqmName},
         eqm_model = #{eqmModel},
         eqm_size =
         #{eqmSize},
         eqm_loc = #{eqmLoc},
         eqm_max_temp = #{eqmMaxTemp},
         eqm_min_temp = #{eqmMinTemp},
         eqm_check = #{eqmCheck},
         eqm_purc_date =
         #{eqmPurcDate},
         eqm_div = #{eqmDiv},
         eqm_img = #{eqmImg},
         eqm_purc_name
         = #{eqmPurcName},
         eqm_purc_tel = #{eqmPurcTel},
         eqm_yn =#{eqmYn},
         line_no = (SELECT l.line_no FROM EQM_LINE l WHERE q.line_no =
         #{l.line_no} )
      </set>
      WHERE eqm_code = #{eqmCode}
   </update>
   <!-- 설비 삭제 -->
   <delete id="deleteEqmInfo" parameterType="EqmVO">
      DELETE FROM EQM
      WHERE
      eqm_code = #{eqmCode}
   </delete>
   <!-- 설비 단건 조회 -->


   <!-- 라인정보 전체조회 -->
   <select id="getEqmLineList" resultType="EqmVO">
      SELECT * FROM eqm_line
      ORDER BY LINE_NO ASC
   </select>

   <!-- 라인정보 등록 -->
   <insert id="insertEqmLine" parameterType="EqmVO">
      INSERT INTO eqm_line
      VALUES (
      #{lineNo},
      #{totPrc},
      #{UPH},
      #{empNo},
      #{lineYn}
      )
   </insert>

   <!-- 라인정보 수정 -->
   <update id="updateEqmLine" parameterType="EqmVO">
      UPDATE EQM_LINE
      <set>
         tot_prc = #{totPrc},
         UPH = #{UPH},
         emp_no = #{empNo},
         line_yn = #{lineYn}
      </set>
      WHERE line_no = #{lineNo}
   </update>

   <!-- 라인정보 삭제 -->
   <delete id="deleteEqmLine" parameterType="EqmVO">
      DELETE FROM eqm_line
      WHERE line_no = #{lineNo}
   </delete>

   <!-- 정기점검 전체조회 -->
   <select id="getEqmChkList" resultType="EqmVO">
      SELECT * FROM EQM_CHK
      ORDER BY CHK_NO ASC
   </select>

   <!-- 정기점검 등록 -->

   <insert id="insertEqmChk" parameterType="EqmVO">
      <selectKey keyProperty="chkNo" resultType="String"
         order="BEFORE">
         SELECT
         'CHK_'||TO_CHAR(SYSDATE,'YYYYMMDD')||LPAD(NVL(MAX(SUBSTR(chk_no,-3)),0)+1,3,0)
         as chk_no
         FROM
         EQM_CHK
      </selectKey>
      INSERT INTO EQM_CHK
      VALUES (
      #{chkNo},
      #{chkDate},
      #{chkNdate},
      #{chkState},
      #{chkSol},
      #{chkEmpNo},
      #{eqmCode})
   </insert>
   
   <!-- 비가동 전체조회  -->
   <select id="getUoperList" resultType="EqmVO">
      SELECT * FROM EQM_UOPER
      ORDER BY uoper_code ASC
   </select>
   
   <!-- 비가동 추가  -->
   <insert id="insertUoper" parameterType="EqmVO">
		<selectKey keyProperty="uoperCode" resultType="String" order="BEFORE">
			SELECT TO_CHAR(SYSDATE,'YYYYMMDD')||'-'||LPAD(NVL(MAX(SUBSTR(uoperCode, -3)),0)+1,3,0) FROM EQM_UOPER
		</selectKey>
		INSERT INTO EQM_UOPER values (#{uoperCode}, #{uoperEmpNo}, #{uoperName}, #{uoperWork}, #{uoperStartTime}, #{uoperEndTime}, #{eqmState}, #{eqmCode})
	
   
   </insert>
   
    <!--  비가동 삭제 -->
   <delete id="deleteUoper" parameterType="EqmVO">
      DELETE FROM EQM_UOPER
      WHERE uoper_code = #{uoperCode}
   </delete>





</mapper>